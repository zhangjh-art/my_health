<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cnasoft.health.userservice.mapper.SysAuthorityMapper">

    <sql id="column_list">
        s.id,s.`type`,s.`name`,s.code,s.parent_code,s.interfaces,s.remark,s.enabled,s.approve_status,
        s.create_by,s.create_time,s.update_by,s.update_time,s.is_deleted
    </sql>

    <select id="findAuthoritiesByAuthId" resultType="java.lang.String">
        select distinct t.code from sys_authority t
        where t.is_deleted = 0 and t.id in
        <foreach collection="authorityIds" index="index" item="authorityId" open="(" separator=","
                 close=")">
            #{authorityId}
        </foreach>
    </select>

    <select id="findList" resultType="com.cnasoft.health.common.dto.SysAuthorityDTO">
        select <include refid="column_list"/>,
        (select name from sys_authority where code = s.parent_code and is_deleted = 0 limit 1) as parent_name
        from sys_authority s
        <where>
            s.is_deleted = 0
            <if test="param.number != null and param.number != ''">
                and s.id = #{param.number}
            </if>
            <if test="param.text != null and param.text != ''">
                and LOCATE(#{param.text}, s.name) > 0
            </if>
            <if test="param.enabled != null">
                and s.enabled = #{param.enabled}
            </if>
        </where>
    </select>
</mapper>
